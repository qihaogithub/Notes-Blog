一个个人博客网站，「笔记仓库」和「博客仓库」完全分离，博客仓库自动读取笔记仓库的 Markdown 文件。无需后端、零维护、安全可靠

---

### 🌟 核心架构

```
笔记仓库 (notes-repo)         博客仓库 (blog-repo)
┌─────────────────┐          ┌─────────────────┐
│  notes/         │          │ .github/        │
│  ├── post1.md   │          │ └── workflows/  │
│  ├── images/    │          │   └── deploy.yml│
│  └── ...        │          │ public/         │
└─────────────────┘          └─────────────────┘
```

- ✅ **笔记仓库**：只存放 Markdown 内容（完全独立）
- ✅ **博客仓库**：只负责静态页面生成和部署（无任何内容）
- ✅ **自动同步**：博客仓库通过 GitHub Actions 定时拉取笔记仓库内容

---

### ✅ 详细实现步骤

#### 🔐 第一步：创建 GitHub PAT（个人访问令牌）

> 用于博客仓库安全访问笔记仓库（仅需**只读权限**）

1. 访问 [GitHub PAT 创建页面](https://github.com/settings/tokens/new)
2. 勾选权限：
   - ✅ `repo`（仅勾选 `repo:status` 和 `repo:public_repo`）
   - ⚠️ **不要勾选 `write:repo` 或 `admin:repo_hook`**
3. 复制生成的 Token（类似 `ghp_abc123...`）

#### 📌 第二步：将 PAT 存入博客仓库的 Secrets

1. 进入你的 **博客仓库** → Settings → Secrets and variables → Actions
2. 点击 **New repository secret**
3. 设置：
   - **Name**: `NOTE_REPO_TOKEN`
   - **Value**: 刚复制的 PAT（如 `ghp_abc123...`）
4. 点击 **Add secret**

#### 📂 第三步：创建博客仓库结构

在博客仓库中创建以下文件：

```
blog-repo/
├── .github/
│   └── workflows/
│       └── deploy.yml      # 自动部署配置
├── package.json            # 依赖配置
├── build.js                # 内容转换脚本
└── public/                 # 生成的静态文件（自动生成）
```

#### ⚙️ 第四步：配置关键文件

**文件：`package.json`**

```json
{
  "name": "blog",
  "version": "1.0.0",
  "scripts": {
    "build": "node build.js"
  },
  "dependencies": {
    "marked": "^4.0.10"
  }
}
```

**文件：`build.js`**（核心脚本）

```javascript
const fs = require("fs");
const path = require("path");
const marked = require("marked");

// === 关键配置 ===
const NOTE_REPO_PATH = "temp-notes"; // 笔记仓库内容存放路径
const PUBLIC_DIR = "public"; // 生成的静态文件目录

// 清空并重建public目录
if (fs.existsSync(PUBLIC_DIR)) {
  fs.rmSync(PUBLIC_DIR, { recursive: true, force: true });
}
fs.mkdirSync(PUBLIC_DIR, { recursive: true });

// 复制笔记仓库的整个目录到public（保留图片等资源）
fs.cpSync(NOTE_REPO_PATH, PUBLIC_DIR, { recursive: true });

// 生成博客首页
const posts = [];
const mdFiles = fs.readdirSync(NOTE_REPO_PATH).filter((f) => f.endsWith(".md"));

mdFiles.forEach((file) => {
  const filePath = path.join(NOTE_REPO_PATH, file);
  const content = fs.readFileSync(filePath, "utf8");

  // 提取标题（优先使用# 标题，否则用文件名）
  let title = file.replace(".md", "");
  const firstLine = content.split("\n")[0];
  if (firstLine.startsWith("# ")) {
    title = firstLine.substring(2).trim();
  }

  // 转换Markdown为HTML
  const html = marked(content);

  // 保存单个文章页
  const htmlFile = path.join(PUBLIC_DIR, file.replace(".md", ".html"));
  fs.writeFileSync(htmlFile, `<html><body>${html}</body></html>`);

  // 记录到首页
  posts.push({ title, filename: file.replace(".md", ".html") });
});

// 生成首页 index.html
let indexHtml = `
<!DOCTYPE html>
<html>
<head>
  <title>我的博客</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    h1 { color: #333; }
    ul { list-style-type: none; padding: 0; }
    li { margin: 15px 0; }
    a { text-decoration: none; color: #0066cc; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>我的博客</h1>
  <ul>
    ${posts
      .map((post) => `<li><a href="${post.filename}">${post.title}</a></li>`)
      .join("")}
  </ul>
</body>
</html>
`;

fs.writeFileSync(path.join(PUBLIC_DIR, "index.html"), indexHtml);
console.log("✅ 博客生成完成！共", posts.length, "篇文章");
```

**文件：`.github/workflows/deploy.yml`**（关键配置）

```yaml
name: Sync Notes & Deploy

on:
  # 每小时自动同步（可调整频率）
  schedule:
    - cron: "0 * * * *" # 每小时执行一次

  # 手动触发（可选）
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出博客主仓库（空仓库）
      - name: Checkout main repo
        uses: actions/checkout@v3

      # 2. 检出笔记仓库（关键！）
      - name: Checkout notes repository
        uses: actions/checkout@v3
        with:
          repository: YOUR_NOTE_REPO_OWNER/NOTE_REPO_NAME # 替换为你的笔记仓库
          ref: main # 笔记仓库分支
          path: temp-notes # 本地存放路径
          token: ${{ secrets.NOTE_REPO_TOKEN }} # 从Secrets读取

      # 3. 如果笔记仓库有子目录（如notes/），需复制内容
      - name: Copy notes content
        if: steps.checkout-notes.outputs.tree != 'empty'
        run: |
          # 假设笔记仓库的Markdown在notes/目录下
          mkdir -p temp-notes
          cp -r NOTE_REPO_PATH/notes/* temp-notes/  # 替换为实际路径

      # 4. 生成静态页面
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install dependencies
        run: npm install

      - name: Build static site
        run: npm run build

      # 5. 部署到GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages
```

> 💡 **关键替换项**（在 `deploy.yml` 中）：
>
> - `YOUR_NOTE_REPO_OWNER/NOTE_REPO_NAME` → 替换为你的笔记仓库地址（如 `octocat/notes`）
> - `NOTE_REPO_PATH/notes/*` → 如果笔记仓库的 Markdown 文件在 `notes/` 目录下，保持此路径；如果直接在根目录，改为 `NOTE_REPO_PATH/*`

---

### 🚀 部署流程

1. **提交博客仓库代码**

   ```bash
   git add .
   git commit -m "Setup cross-repo blog"
   git push origin main
   ```

2. **启用 GitHub Pages**

   - 进入博客仓库 → Settings → Pages
   - Source 选择 `gh-pages branch`
   - 保存后等待 1-2 分钟

3. **访问你的博客**

   - URL：`https://<你的GitHub用户名>.github.io/<博客仓库名>`
   - 示例：`https://username.github.io/blog`

4. **测试自动同步**
   - 去笔记仓库新增/修改 Markdown 文件
   - 等待 1 小时（或手动触发工作流）
   - 博客会自动更新！

---

### 🔍 常见问题解决

#### ❓ 为什么需要 `NOTE_REPO_PATH/notes/*`？

- 如果你的笔记仓库结构是：
  ```
  notes-repo/
    ├── notes/       # 所有Markdown文件在此
    │   ├── post1.md
    │   └── images/
    └── README.md    # 不需要的文件
  ```
- 则需要复制 `notes/` 目录内容到 `temp-notes`：
  ```yaml
  - name: Copy notes content
    run: |
      mkdir -p temp-notes
      cp -r temp-notes/notes/* temp-notes/  # 注意：这里会覆盖temp-notes
  ```

#### ❓ 如何处理图片路径？

- ✅ **完全自动处理**：在 Markdown 中写 `![图片](images/photo.jpg)`，图片会自动复制到 `public/images/`
- ✅ 访问时直接使用 `/images/photo.jpg` 路径

#### ❓ 笔记仓库是私有的怎么办？

- 在创建 PAT 时勾选 `repo` 全权限（因为私有仓库需要完整权限）
- 确保 PAT 有 `repo` 权限（非 `public_repo`）

#### ❓ 如何加速同步（非每小时）？

- 修改 `deploy.yml` 中的 `cron` 表达式：
  ```yaml
  schedule:
    - cron: "*/30 * * * *" # 每30分钟同步一次
  ```
- 或手动触发：进入博客仓库 → Actions → 右侧 "Sync Notes & Deploy" → 点击 "Run workflow"

---

### 💡 为什么这个方案最安全？

| 安全特性           | 说明                                                     |
| ------------------ | -------------------------------------------------------- |
| **最小权限原则**   | PAT 仅需 `repo:status` 和 `repo:public_repo`（只读权限） |
| **无敏感信息泄露** | PAT 仅存于 GitHub Secrets，代码中永不出现                |
| **隔离部署**       | 博客仓库和笔记仓库完全隔离，一个仓库被黑不影响另一个     |
| **无后端依赖**     | 所有操作在 GitHub 内部完成，无需暴露服务器 IP 或 API     |

---

### ✅ 最终效果

- ✨ **笔记仓库**：专注写内容（Markdown + 图片）
- ✨ **博客仓库**：只负责生成静态页（无任何内容）
- ✨ **自动同步**：每小时自动拉取最新笔记内容
- ✨ **零维护**：完全自动化，无需任何服务器

> ⚡️ **立即动手试试**：
>
> 1. 复制上面的代码模板到你的博客仓库
> 2. 替换 `deploy.yml` 中的笔记仓库地址
> 3. 提交代码 → 等待 1 小时 → 访问你的博客！
>
> **无需任何后端知识，纯前端方案，100% 免费！** 🚀
